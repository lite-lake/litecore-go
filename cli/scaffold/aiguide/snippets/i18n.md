# i18n 多语言开发

> 适用于使用 `--i18n` 选项创建的脚手架项目。

## 项目结构

```
myapp/
├── internal/
│   ├── controllers/
│   │   └── page_controller.go    # 页面控制器
│   └── services/
│       ├── i18n_service.go       # 国际化服务
│       └── html_template_service.go
├── templates/
│   ├── _head.html                # 头部 partial 模板
│   ├── _header.html              # 页头 partial 模板
│   ├── _footer.html              # 页脚 partial 模板
│   ├── _nav.html                 # 导航 partial 模板
│   ├── index.html                # 首页
│   └── about.html                # 关于页面
└── static/
    └── locales/                  # 翻译文件
        ├── en.json               # 英文
        ├── zhs.json              # 简体中文
        └── ar.json               # 阿拉伯语
```

## 路由规则

路径式语言路由：

- `/` → 自动重定向到默认语言 `/en`
- `/:lang` → 语言首页（如 `/en`, `/zhs`, `/ar`）
- `/:lang/about` → 语言关于页面

## Controller 示例

```go
package controllers

import (
	"strings"
	"your-project/internal/services"
	"github.com/gin-gonic/gin"
	"github.com/lite-lake/litecore-go/common"
	"github.com/lite-lake/litecore-go/manager/loggermgr"
)

type IPageController interface {
	common.IBaseController
}

type pageControllerImpl struct {
	HTMLTemplateService services.IHTMLTemplateService `inject:""`
	I18nService         services.II18nService         `inject:""`
	LoggerMgr           loggermgr.ILoggerManager      `inject:""`
}

func NewPageController() IPageController {
	return &pageControllerImpl{}
}

func (c *pageControllerImpl) ControllerName() string {
	return "pageControllerImpl"
}

func (c *pageControllerImpl) GetRouter() string {
	return "/ [GET],/:lang [GET],/:lang/about [GET]"
}

func (c *pageControllerImpl) Handle(ctx *gin.Context) {
	lang := ctx.Param("lang")
	if lang == "" {
		// 根路径重定向到默认语言
		ctx.Redirect(302, "/"+c.I18nService.GetDefaultLanguage())
		return
	}
	
	if !c.I18nService.IsSupportedLanguage(lang) {
		lang = c.I18nService.GetDefaultLanguage()
	}

	// 根据路径判断渲染哪个页面
	path := ctx.Request.URL.Path
	if strings.HasSuffix(path, "/about") {
		c.HTMLTemplateService.Render(ctx, "about.html", gin.H{
			"Title":          "MyApp",
			"Lang":           lang,
			"SupportedLangs": c.I18nService.GetSupportedLanguages(),
			"I18nService":    c.I18nService,
		})
		return
	}

	c.HTMLTemplateService.Render(ctx, "index.html", gin.H{
		"Title":          "MyApp",
		"Lang":           lang,
		"SupportedLangs": c.I18nService.GetSupportedLanguages(),
		"I18nService":    c.I18nService,
	})
}
```

## HTML 模板中使用翻译

```html
<!DOCTYPE html>
<html lang="{{.Lang}}" dir="{{if eq .Lang "ar"}}rtl{{else}}ltr{{end}}">
<head>
    {{template "_head" .}}
</head>
<body class="bg-gray-50{{if eq .Lang "ar"}} text-right{{end}}">
    {{template "_header" .}}
    {{template "_nav" (dict "Lang" .Lang "ActivePage" "home" "I18nService" .I18nService)}}

    <main class="flex-grow-1 py-5">
        <div class="container">
            <h1>{{t .Lang "welcome.title"}}</h1>
            <p>{{t .Lang "welcome.desc"}}</p>
        </div>
    </main>

    {{template "_footer" .}}
</body>
</html>
```

## 翻译文件格式

`static/locales/en.json`:

```json
{
  "site.title": "MyApp",
  "site.description": "Welcome to MyApp",
  "nav.home": "Home",
  "nav.about": "About",
  "welcome.title": "Welcome to MyApp",
  "welcome.desc": "This is a multilingual web application.",
  "about.title": "About MyApp",
  "about.desc": "MyApp is built with LiteCore framework.",
  "footer.copyright": "2026 MyApp. All rights reserved."
}
```

## 语言切换链接

在模板中生成语言切换链接：

```html
<div class="mb-2 text-xs text-gray-400">
    {{range $i, $lang := .SupportedLangs}}
        {{if gt $i 0}}<span class="text-gray-300 mx-1">|</span>{{end}}
        <a href="/{{$lang}}" class="hover:text-gray-600 {{if eq $.Lang $lang}}font-bold text-gray-600{{end}}">
            {{$lang}}
        </a>
    {{end}}
</div>
```

## 导航高亮

传递 ActivePage 参数到导航模板：

```html
{{template "_nav" (dict "Lang" .Lang "ActivePage" "home" "I18nService" .I18nService)}}
```

在 `_nav.html` 中根据 ActivePage 高亮当前页面：

```html
<nav class="bg-gray-50 border-b border-gray-200 py-2">
    <div class="container">
        <div class="d-flex justify-content-center align-items-center gap-4">
            <a href="/{{.Lang}}" 
               class="text-sm {{if eq .ActivePage "home"}}text-gray-900 fw-medium{{else}}text-gray-500{{end}}">
                {{t .Lang "nav.home"}}
            </a>
            <a href="/{{.Lang}}/about" 
               class="text-sm {{if eq .ActivePage "about"}}text-gray-900 fw-medium{{else}}text-gray-500{{end}}">
                {{t .Lang "nav.about"}}
            </a>
        </div>
    </div>
</nav>
```

## RTL 支持

阿拉伯语（ar）自动启用从右到左布局：

- HTML: `dir="rtl"`
- Body: `class="text-right"`

## 添加新语言

1. 在 `static/locales/` 创建新的 JSON 文件（如 `fr.json`）
2. 在 `internal/services/i18n_service.go` 中添加语言到支持列表：

```go
func (s *i18nServiceImpl) GetSupportedLanguages() []string {
	return []string{"en", "zhs", "ar", "fr"}  // 添加 "fr"
}
```

3. 重新生成容器代码：

```bash
go run ./cmd/generate
```

## I18n Service 接口

```go
type II18nService interface {
	common.IBaseService
	T(lang, key string) string                           // 翻译
	TWithData(lang, key string, data map[string]interface{}) string  // 带变量翻译
	GetSupportedLanguages() []string                     // 获取支持的语言列表
	IsSupportedLanguage(lang string) bool                // 检查语言是否支持
	GetDefaultLanguage() string                          // 获取默认语言
}
```

## 验证命令

```bash
go run ./cmd/generate && go run ./cmd/server
```

访问：
- `http://localhost:8080/` → 重定向到 `/en`
- `http://localhost:8080/en` → 英文首页
- `http://localhost:8080/zhs` → 中文首页
- `http://localhost:8080/ar` → 阿拉伯语首页（RTL）
